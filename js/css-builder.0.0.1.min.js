if("undefined"==typeof _)throw new Error("css-builder requires underscore");(function(){function e(t,s){for(var n=t.cssRules||t.rules||[],a=0;a<n.length;a++){var r=n[a];r.type==CSSRule.IMPORT_RULE?e(r.styleSheet,s):r.type!==CSSRule.KEYFRAMES_RULE&&r.type!==CSSRule.MOZ_KEYFRAMES_RULE&&r.type!==CSSRule.WEBKIT_KEYFRAMES_RULE||s(r,t,a)}}function t(e){this.original=e,this.keyText=e.keyText,this.css={};for(var t=e.style.cssText.split(";"),s=0;s<t.length;s++){var n=t[s].split(":");if(2==n.length){var a=n[0].replace(/^\s+|\s+$/g,""),r=n[1].replace(/^\s+|\s+$/g,"");this.css[a]=r}}}function s(e){this.original=e,this.name=e.name,this.keyframes=[],this.keytexts=[],this.keyframeHash={},this.initKeyframes()}function n(){this.animations={};for(var t=document.styleSheets,n=this.animations,a=0;a<t.length;a++)try{e(t[a],function(e){n[e.name]=new s(e)})}catch(r){}}function a(e,t){_.has(e,t)&&delete e[t]}function r(e,t){o(t)?a(e,t):c(t)?_.each(t,function(t){a(e,t)}):i(t)&&_.each(t,function(t,s){a(e,s)})}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){return"[object String]"===Object.prototype.toString.call(e)}function l(e,t){var s="";c(t)?(_.each(t,function(e){s=s+e+"|"}),s=s.substr(0,s.length-1)):s=t;var n=new RegExp(s);return n.test(e)}function h(e,t){return o(e)&&l(e,"px$|%$|cm$|em$|rem$|pt$|ms$|s$")?e:(t||(t="px"),e=parseFloat(e),e+t)}function u(e,t,s){return l(e,"width|height|top|left|right|bottom|margin|padding|size")?h(t,s):t}function f(e,t){var s={};return t&&""!=t?(s[e]=t,s["-webkit-"+e]=t,s["-moz-"+e]=t,s["-ms-"+e]=t,s["-o-"+e]=t,s):s}function y(e){var t={scaleX:1,scaleY:1};_.has(e,"scale")&&(t.scaleX=e.scale,t.scaleY=e.scale,delete e.scale),_.has(e,"scaleX")&&(t.scaleX=e.scaleX,delete e.scaleX),_.has(e,"scaleY")&&(t.scaleY=e.scaleY,delete e.scaleY),1!=t.scaleX&&1!=t.scaleY&&(e.scaleString="scale("+t.scaleX+","+t.scaleY+") ")}function m(e,t){if(_.has(e,"transform"))return e.transform;var s="";return e=_.clone(e),y(e),_.each(e,function(e,n){switch(n){case"x":s+="translateX("+h(e,t)+") ";break;case"y":s+="translateY("+h(e,t)+") ";break;case"scaleString":s+=e;break;case"rotate":s+="rotate("+h(e,"deg")+") ";break;case"rotateX":s+="rotateX("+h(e,"deg")+") ";break;case"rotateY":s+="rotateY("+h(e,"deg")+") ";break;case"rotateZ":s+="rotateZ("+h(e,"deg")+") "}}),s}function p(e,t){return f("transform",m(e,t))}var d=this,g={};g.style=function(){if(!g.styleDom){var e=document.createElement("style");e.rel="stylesheet",e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e),g.styleDom=e}return g.styleDom},s.prototype.initKeyframes=function(){this.keyframes=[],this.keytexts=[],this.keyframeHash={};for(var e=this.original,s=0;s<e.cssRules.length;s++){var n=new t(e.cssRules[s]);this.keyframes.push(n),this.keytexts.push(n.keyText),this.keyframeHash[n.keyText]=n}},s.prototype.getKeyframeTexts=function(){return this.keytexts},s.prototype.getKeyframe=function(e){return this.keyframeHash[e]},s.prototype.setKeyframe=function(e,t){var s=e+" {";for(var n in t)s+=n+":"+t[n]+";";return s+="}","appendRule"in this.original?this.original.appendRule(s):this.original.insertRule(s),this.initKeyframes(),this},s.prototype.setKeyframes=function(e){for(var t in e)this.setKeyframe(t,e[t])},s.prototype.clear=function(){for(var e=0;e<this.keyframes.length;e++)this.original.deleteRule(this.keyframes[e].keyText)},n.prototype.get=function(e){return this.animations[e]},n.prototype.getDynamicSheet=function(){if(!this.dynamicSheet){var e=document.createElement("style");e.rel="stylesheet",e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e),this.dynamicSheet=e.sheet}return this.dynamicSheet},n.prototype.create=function(e,t){var n=this.getDynamicSheet();"object"==typeof e&&(t=e,e=null),e||(e="anim"+Math.floor(1e5*Math.random()));try{var a=n.insertRule("@keyframes "+e+"{}",n.cssRules.length)}catch(r){if("SYNTAX_ERR"!=r.name&&"SyntaxError"!=r.name)throw r;a=n.insertRule("@-webkit-keyframes "+e+"{}",n.cssRules.length)}var i=new s(n.cssRules[a]);return this.animations[e]=i,t&&i.setKeyframes(t),i},n.prototype.remove=function(t){var n=this.getDynamicSheet();t=t instanceof s?t.name:t,this.animations[t]=null;try{e(n,function(e,s,n){e.name==t&&s.deleteRule(n)})}catch(a){}},g.Animations=new n,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports.CssBuilder=g):d.CssBuilder=g,g.smartObject=function(e,t){e=_.clone(e);var s=p(e,t);r(e,["x","y","scale","scaleX","scaleY","rotate","rotateX","rotateY"]);var n={};return _.each(e,function(e,s){l(s,"^animation|^transform-|^perspective|^backface-visibility")?_.extend(n,f(s,u(s,e,t))):n[s]=u(s,e,t)}),_.extend(s,n)},g.createCssString=function(e){var t=this.style();if(t.styleSheet)t.styleSheet.cssText=e;else{var s=document,n=s.createTextNode(e);t.appendChild(n)}},g.createCssObject=function(e,t,s){var n=this,a="",r=n.smartObject(t,s);_.each(r,function(e,t){a+=t+":"+e+";"});var i=e+"{"+a+"}";n.createCssString(i)},g.css=function(e,t){_.each(t,function(t,s){t?e.style[s]=t:e.style[s]=""})},g.cssSmartObject=function(e,t,s){this.css(e,this.smartObject(t,s))}}).call(this);